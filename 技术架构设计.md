# AI Video Character Lab - æŠ€æœ¯æ¶æ„è®¾è®¡

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             ç”¨æˆ·å±‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚    Webç«¯    â”‚  â”‚   ç§»åŠ¨ç«¯    â”‚  â”‚    API     â”‚  â”‚   ç®¡ç†åå°   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             ç½‘å…³å±‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Nginx     â”‚  â”‚   CDN       â”‚  â”‚   é™æµ     â”‚  â”‚   è®¤è¯      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             åº”ç”¨å±‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   å‰ç«¯åº”ç”¨  â”‚  â”‚   åç«¯API   â”‚  â”‚   ä»»åŠ¡é˜Ÿåˆ—  â”‚  â”‚   ç¼“å­˜æœåŠ¡  â”‚      â”‚
â”‚  â”‚  (Next.js) â”‚  â”‚  (FastAPI)  â”‚  â”‚   (Celery) â”‚  â”‚   (Redis)   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             æœåŠ¡å±‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  è§’è‰²ç®¡ç†   â”‚  â”‚  è§†é¢‘ç”Ÿæˆ   â”‚  â”‚  è„šæœ¬ç”Ÿæˆ   â”‚  â”‚  æ–‡ä»¶å­˜å‚¨   â”‚      â”‚
â”‚  â”‚  æœåŠ¡      â”‚  â”‚  æœåŠ¡      â”‚  â”‚  æœåŠ¡      â”‚  â”‚  æœåŠ¡      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             æ•°æ®å±‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ PostgreSQL â”‚  â”‚    Redis    â”‚  â”‚   MinIO     â”‚  â”‚  å‘é‡æ•°æ®åº“ â”‚      â”‚
â”‚  â”‚  (ä¸»æ•°æ®åº“) â”‚  â”‚   (ç¼“å­˜)    â”‚  â”‚  (æ–‡ä»¶å­˜å‚¨) â”‚  â”‚  (è§’è‰²ç‰¹å¾) â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             AIæ¨¡å‹å±‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Stable     â”‚  â”‚   Runway    â”‚  â”‚    GPT-4    â”‚  â”‚  å…¶ä»–AI     â”‚      â”‚
â”‚  â”‚ Diffusion  â”‚  â”‚   Gen-3     â”‚  â”‚   (è„šæœ¬)    â”‚  â”‚   æ¨¡å‹      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æ ¸å¿ƒæœåŠ¡è®¾è®¡

### 1. è§’è‰²ç®¡ç†æœåŠ¡ (Character Management Service)

#### åŠŸèƒ½èŒè´£
- è§’è‰²å›¾ç‰‡ä¸Šä¼ å’Œé¢„å¤„ç†
- è§’è‰²ç‰¹å¾å‘é‡ç”Ÿæˆ (Embedding)
- è§’è‰²å…ƒæ•°æ®ç®¡ç†
- è§’è‰²ä¸€è‡´æ€§éªŒè¯

#### æŠ€æœ¯å®ç°
```python
# è§’è‰²ç®¡ç†æœåŠ¡æ¶æ„
class CharacterService:
    def __init__(self):
        self.embedding_model = StableDiffusionEmbedding()
        self.storage = MinIOStorage()
        self.vector_db = PineconeVectorDB()
    
    async def create_character(self, images: List[Image], metadata: Dict):
        # 1. å›¾ç‰‡é¢„å¤„ç†
        processed_images = await self.preprocess_images(images)
        
        # 2. ç”Ÿæˆè§’è‰²ç‰¹å¾å‘é‡
        embedding = await self.generate_embedding(processed_images)
        
        # 3. å­˜å‚¨åˆ°å‘é‡æ•°æ®åº“
        character_id = await self.vector_db.store(embedding, metadata)
        
        # 4. ä¿å­˜å›¾ç‰‡åˆ°æ–‡ä»¶å­˜å‚¨
        await self.storage.store_images(character_id, processed_images)
        
        return character_id
```

#### æ•°æ®åº“è®¾è®¡
```sql
-- è§’è‰²è¡¨
CREATE TABLE characters (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,
    description TEXT,
    user_id UUID REFERENCES users(id),
    embedding_vector VECTOR(768), -- 768ç»´ç‰¹å¾å‘é‡
    metadata JSONB,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- è§’è‰²å›¾ç‰‡è¡¨
CREATE TABLE character_images (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    character_id UUID REFERENCES characters(id),
    image_url VARCHAR(500) NOT NULL,
    image_type VARCHAR(20), -- 'reference', 'generated'
    created_at TIMESTAMP DEFAULT NOW()
);
```

### 2. è§†é¢‘ç”ŸæˆæœåŠ¡ (Video Generation Service)

#### åŠŸèƒ½èŒè´£
- æ¥æ”¶ç”Ÿæˆè¯·æ±‚
- è°ƒç”¨AIè§†é¢‘ç”Ÿæˆæ¨¡å‹
- è§’è‰²ä¸€è‡´æ€§ä¿è¯
- è§†é¢‘åå¤„ç†

#### æŠ€æœ¯å®ç°
```python
# è§†é¢‘ç”ŸæˆæœåŠ¡æ¶æ„
class VideoGenerationService:
    def __init__(self):
        self.runway_client = RunwayGen3Client()
        self.character_service = CharacterService()
        self.task_queue = CeleryQueue()
    
    async def generate_video(self, request: VideoGenerationRequest):
        # 1. è·å–è§’è‰²ç‰¹å¾
        character = await self.character_service.get_character(request.character_id)
        
        # 2. ç”Ÿæˆåˆ†é•œè„šæœ¬
        storyboard = await self.generate_storyboard(request.script, character)
        
        # 3. æäº¤è§†é¢‘ç”Ÿæˆä»»åŠ¡
        task = await self.task_queue.submit(
            'generate_video',
            args=[character.embedding, storyboard, request.settings]
        )
        
        return task.id
```

#### ä»»åŠ¡é˜Ÿåˆ—è®¾è®¡
```python
# Celeryä»»åŠ¡å®šä¹‰
@celery_app.task(bind=True)
def generate_video(self, character_embedding, storyboard, settings):
    try:
        # 1. è°ƒç”¨Runway Gen-3 API
        video_url = runway_client.generate(
            prompt=storyboard,
            character_embedding=character_embedding,
            settings=settings
        )
        
        # 2. ä¸‹è½½è§†é¢‘æ–‡ä»¶
        video_file = download_video(video_url)
        
        # 3. åå¤„ç†ï¼ˆå‹ç¼©ã€æ ¼å¼è½¬æ¢ç­‰ï¼‰
        processed_video = post_process_video(video_file)
        
        # 4. ä¸Šä¼ åˆ°å­˜å‚¨
        final_url = upload_video(processed_video)
        
        return final_url
        
    except Exception as e:
        self.retry(countdown=60, max_retries=3)
```

### 3. è„šæœ¬ç”ŸæˆæœåŠ¡ (Script Generation Service)

#### åŠŸèƒ½èŒè´£
- ç”¨æˆ·è¾“å…¥å¤„ç†
- GPT-4è°ƒç”¨
- åˆ†é•œè„šæœ¬ç”Ÿæˆ
- å¤šè¯­è¨€æ”¯æŒ

#### æŠ€æœ¯å®ç°
```python
# è„šæœ¬ç”ŸæˆæœåŠ¡æ¶æ„
class ScriptGenerationService:
    def __init__(self):
        self.openai_client = OpenAI()
        self.translator = GoogleTranslate()
    
    async def generate_storyboard(self, script: str, language: str = 'zh'):
        # 1. è¯­è¨€æ£€æµ‹å’Œç¿»è¯‘
        if language != 'zh':
            script = await self.translator.translate(script, 'zh')
        
        # 2. è°ƒç”¨GPT-4ç”Ÿæˆåˆ†é•œ
        prompt = self.build_storyboard_prompt(script)
        response = await self.openai_client.chat.completions.create(
            model="gpt-4",
            messages=[{"role": "user", "content": prompt}],
            temperature=0.7
        )
        
        # 3. è§£æåˆ†é•œè„šæœ¬
        storyboard = self.parse_storyboard(response.choices[0].message.content)
        
        return storyboard
```

## ğŸ”§ æŠ€æœ¯é€‰å‹è¯¦è§£

### å‰ç«¯æŠ€æœ¯æ ˆ

#### Next.js 14 + React 18
**é€‰æ‹©ç†ç”±**ï¼š
- æœåŠ¡ç«¯æ¸²æŸ“ (SSR) æå‡é¦–å±åŠ è½½é€Ÿåº¦
- App Router æä¾›æ›´å¥½çš„è·¯ç”±ä½“éªŒ
- å†…ç½®APIè·¯ç”±ç®€åŒ–å¼€å‘
- ä¼˜ç§€çš„TypeScriptæ”¯æŒ

**é¡¹ç›®ç»“æ„**ï¼š
```
frontend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (auth)/
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â””â”€â”€ register/
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ characters/
â”‚   â”‚   â”œâ”€â”€ videos/
â”‚   â”‚   â””â”€â”€ settings/
â”‚   â”œâ”€â”€ api/
â”‚   â””â”€â”€ globals.css
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ forms/
â”‚   â””â”€â”€ layout/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ utils.ts
â”‚   â”œâ”€â”€ api.ts
â”‚   â””â”€â”€ auth.ts
â””â”€â”€ types/
    â””â”€â”€ index.ts
```

#### TailwindCSS + Shadcn/UI
**é€‰æ‹©ç†ç”±**ï¼š
- åŸå­åŒ–CSSæå‡å¼€å‘æ•ˆç‡
- å“åº”å¼è®¾è®¡æ”¯æŒ
- ä¸°å¯Œçš„ç»„ä»¶åº“
- é«˜åº¦å¯å®šåˆ¶

### åç«¯æŠ€æœ¯æ ˆ

#### FastAPI (Python)
**é€‰æ‹©ç†ç”±**ï¼š
- é«˜æ€§èƒ½å¼‚æ­¥æ¡†æ¶
- è‡ªåŠ¨APIæ–‡æ¡£ç”Ÿæˆ
- ä¼˜ç§€çš„ç±»å‹æç¤ºæ”¯æŒ
- ä¸°å¯Œçš„ä¸­é—´ä»¶ç”Ÿæ€

**é¡¹ç›®ç»“æ„**ï¼š
```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ v1/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”‚   â”œâ”€â”€ characters.py
â”‚   â”‚   â”‚   â”œâ”€â”€ videos.py
â”‚   â”‚   â”‚   â””â”€â”€ scripts.py
â”‚   â”‚   â””â”€â”€ deps.py
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”œâ”€â”€ security.py
â”‚   â”‚   â””â”€â”€ database.py
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ schemas/
â”‚   â”œâ”€â”€ services/
â”‚   â””â”€â”€ utils/
â”œâ”€â”€ tests/
â”œâ”€â”€ alembic/
â””â”€â”€ requirements.txt
```

#### PostgreSQL + Supabase
**é€‰æ‹©ç†ç”±**ï¼š
- å¼ºå¤§çš„å…³ç³»å‹æ•°æ®åº“
- JSONBæ”¯æŒçµæ´»æ•°æ®å­˜å‚¨
- å‘é‡æ‰©å±•æ”¯æŒAIç‰¹å¾å­˜å‚¨
- Supabaseæä¾›æ‰˜ç®¡å’Œå®æ—¶åŠŸèƒ½

### AIæ¨¡å‹é›†æˆ

#### Stable Diffusion + LoRA
**è§’è‰²ä¸€è‡´æ€§å®ç°**ï¼š
```python
class CharacterConsistencyService:
    def __init__(self):
        self.model = StableDiffusionPipeline.from_pretrained(
            "runwayml/stable-diffusion-v1-5"
        )
        self.lora_adapter = LoRAAdapter()
    
    async def generate_consistent_image(self, prompt: str, character_embedding: List[float]):
        # 1. åŠ è½½è§’è‰²LoRAæ¨¡å‹
        self.model.load_lora_weights(character_embedding)
        
        # 2. ç”Ÿæˆå›¾åƒ
        image = self.model(
            prompt=prompt,
            num_inference_steps=50,
            guidance_scale=7.5
        ).images[0]
        
        return image
```

#### Runway Gen-3 API
**è§†é¢‘ç”Ÿæˆé›†æˆ**ï¼š
```python
class RunwayGen3Client:
    def __init__(self, api_key: str):
        self.api_key = api_key
        self.base_url = "https://api.runwayml.com/v1"
    
    async def generate_video(self, prompt: str, character_embedding: List[float], settings: Dict):
        headers = {
            "Authorization": f"Bearer {self.api_key}",
            "Content-Type": "application/json"
        }
        
        payload = {
            "prompt": prompt,
            "character_embedding": character_embedding,
            "duration": settings.get("duration", 30),
            "style": settings.get("style", "realistic"),
            "quality": settings.get("quality", "standard")
        }
        
        response = await httpx.post(
            f"{self.base_url}/video/generations",
            headers=headers,
            json=payload
        )
        
        return response.json()
```

## ğŸš€ éƒ¨ç½²æ¶æ„

### å®¹å™¨åŒ–éƒ¨ç½²
```yaml
# docker-compose.yml
version: '3.8'
services:
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:8000
    depends_on:
      - backend
  
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/aivideo
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis
  
  db:
    image: postgres:15
    environment:
      - POSTGRES_DB=aivideo
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass
    volumes:
      - postgres_data:/var/lib/postgresql/data
  
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
  
  celery:
    build: ./backend
    command: celery -A app.celery_app worker --loglevel=info
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/aivideo
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis

volumes:
  postgres_data:
```

### CI/CDæµç¨‹
```yaml
# .github/workflows/deploy.yml
name: Deploy to Production

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run Tests
        run: |
          cd backend && python -m pytest
          cd frontend && npm test
  
  deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.ORG_ID }}
          vercel-project-id: ${{ secrets.PROJECT_ID }}
      
      - name: Deploy Backend
        run: |
          # éƒ¨ç½²åˆ°Railwayæˆ–å…¶ä»–å¹³å°
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. ç¼“å­˜ç­–ç•¥
- **Redisç¼“å­˜**ï¼šç”¨æˆ·ä¼šè¯ã€APIå“åº”ã€è®¡ç®—ç»“æœ
- **CDNç¼“å­˜**ï¼šé™æ€èµ„æºã€ç”Ÿæˆçš„è§†é¢‘æ–‡ä»¶
- **æµè§ˆå™¨ç¼“å­˜**ï¼šå‰ç«¯èµ„æºã€ç”¨æˆ·åå¥½è®¾ç½®

### 2. å¼‚æ­¥å¤„ç†
- **Celeryä»»åŠ¡é˜Ÿåˆ—**ï¼šè§†é¢‘ç”Ÿæˆã€å›¾ç‰‡å¤„ç†ç­‰è€—æ—¶æ“ä½œ
- **WebSocket**ï¼šå®æ—¶è¿›åº¦æ›´æ–°ã€çŠ¶æ€é€šçŸ¥
- **äº‹ä»¶é©±åŠ¨**ï¼šè§£è€¦æœåŠ¡é—´é€šä¿¡

### 3. æ•°æ®åº“ä¼˜åŒ–
- **è¿æ¥æ± **ï¼šç®¡ç†æ•°æ®åº“è¿æ¥
- **ç´¢å¼•ä¼˜åŒ–**ï¼šæŸ¥è¯¢æ€§èƒ½æå‡
- **è¯»å†™åˆ†ç¦»**ï¼šä¸»ä»æ•°æ®åº“æ¶æ„

### 4. ç›‘æ§å’Œå‘Šè­¦
- **Sentry**ï¼šé”™è¯¯ç›‘æ§å’Œæ€§èƒ½è¿½è¸ª
- **Prometheus + Grafana**ï¼šç³»ç»ŸæŒ‡æ ‡ç›‘æ§
- **Uptime Robot**ï¼šæœåŠ¡å¯ç”¨æ€§ç›‘æ§

## ğŸ”’ å®‰å…¨è€ƒè™‘

### 1. è®¤è¯å’Œæˆæƒ
- **JWT Token**ï¼šæ— çŠ¶æ€è®¤è¯
- **OAuth 2.0**ï¼šç¬¬ä¸‰æ–¹ç™»å½•æ”¯æŒ
- **RBAC**ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶

### 2. æ•°æ®å®‰å…¨
- **æ•°æ®åŠ å¯†**ï¼šæ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
- **APIé™æµ**ï¼šé˜²æ­¢æ»¥ç”¨å’Œæ”»å‡»
- **è¾“å…¥éªŒè¯**ï¼šé˜²æ­¢æ³¨å…¥æ”»å‡»

### 3. åŸºç¡€è®¾æ–½å®‰å…¨
- **HTTPS**ï¼šä¼ è¾“å±‚å®‰å…¨
- **é˜²ç«å¢™**ï¼šç½‘ç»œè®¿é—®æ§åˆ¶
- **å®šæœŸå¤‡ä»½**ï¼šæ•°æ®æ¢å¤ä¿éšœ

---

*è¿™ä»½æŠ€æœ¯æ¶æ„è®¾è®¡æ–‡æ¡£ä¸ºAIæ¶æ„å¸ˆæä¾›äº†å®Œæ•´çš„ç³»ç»Ÿè®¾è®¡æŒ‡å¯¼ï¼ŒåŒ…æ‹¬æ¶æ„æ¨¡å¼ã€æŠ€æœ¯é€‰å‹ã€å®ç°ç»†èŠ‚å’Œéƒ¨ç½²ç­–ç•¥ã€‚é€šè¿‡éµå¾ªè¿™ä¸ªæ¶æ„ï¼ŒAIç¨‹åºå‘˜å¯ä»¥é«˜æ•ˆåœ°å®ç°å„ä¸ªåŠŸèƒ½æ¨¡å—ã€‚* 